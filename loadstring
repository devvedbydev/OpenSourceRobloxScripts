-- HTTP UNC
function httpget(url)
    local d, ise, Body = false, false, ""
    game:GetService("HttpService"):RequestInternal({Url = url, Method = "GET"}):Start(function(suc, res)
        if not suc then
            Body = res.StatusCode
            ise = true
            d = true
            return
        end
        Body = res.Body
        d = true
    end)
    repeat task.wait() until d
    if ise then error(Body, 0) end
    return Body
end

function getgenv()
    return getfenv(2)
end

-- Set loadstring globally if not already set
if not getgenv().loadstring then
    getgenv().loadstring = getfenv().loadstring
end

-- Ensure currGame is set globally
if not getgenv().currGame then
    getgenv().currGame = game
end

local oldGame = getgenv().currGame

-- Make the custom functions globally available
local function setupGlobalGame()
    return setmetatable({}, {
        __index = function(t, v)
            if v == "HttpGet" then
                return function(_, url)
                    return httpget(url)
                end
            end
            if v == "GetService" then
                return function(_, a)
                    return oldGame:GetService(a)
                end
            end
            if v == "FindService" then
                return function(_, a)
                    return oldGame:FindService(a)
                end
            end
            return oldGame[v]
        end
    })
end

getgenv().game = setupGlobalGame()

-- INTERNAL UI
print("INTERNAL UI LOADED, PRESS INSERT")
local internalUILoaded, internalUIError = pcall(function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/hitbyharibo/byfron/main/internal_ui", true))()
end)

if internalUILoaded then
    -- CHAT ADMIN
    local chatAdminLoaded, chatAdminError = pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/hitbyharibo/byfron/main/chat_admin", true))()
    end)
    
    if not chatAdminLoaded then
        warn("Failed to load CHAT ADMIN:", chatAdminError)
    end
else
    warn("Failed to load INTERNAL UI:", internalUIError)
end

-- OTHER SHI
