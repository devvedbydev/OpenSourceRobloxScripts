-- LOAD HTTP FUNCTIONS
local function httpget(url)
    local d, ise, Body = false, false, ""
    local success, response = pcall(function()
        return game:GetService("HttpService"):RequestAsync({
            Url = url,
            Method = "GET"
        })
    end)

    if not success then
        Body = response
        ise = true
        d = true
        return
    end

    Body = response.Body
    d = true
    return Body
end

local function getgenv()
    return getfenv(2)
end

if type(getgenv().loadstring) ~= "function" then
    getgenv().loadstring = loadstring
end

if not getgenv().currGame then
    getgenv().currGame = game
end

local oldGame = getgenv().currGame
local game = setmetatable({}, {
    __index = function(t, v)
        if v == "HttpGet" then
            return function(_, url)
                return httpget(url)
            end
        end
        if v == "GetService" then
            return function(_, a)
                return oldGame:GetService(a)
            end
        end
        if v == "FindService" then
            return function(_, a)
                return oldGame:FindService(a)
            end
        end
        return oldGame[v]
    end
})

-- INTERNAL UI
print("INTERNAL UI LOADED, PRESS INSERT")
local internalUILoaded, internalUIError = pcall(function()
    local url = "https://raw.githubusercontent.com/hitbyharibo/byfron/main/internal_ui"
    local script, err = httpget(url)
    if not script then
        error("Failed to fetch internal UI script: " .. err)
    end
    local func, loadError = loadstring(script)
    if not func then
        error("Failed to compile internal UI script: " .. loadError)
    end
    func()
end)

if internalUILoaded then
    -- CHAT ADMIN
    local chatAdminLoaded, chatAdminError = pcall(function()
        local url = "https://raw.githubusercontent.com/hitbyharibo/byfron/main/chat_admin"
        local script, err = httpget(url)
        if not script then
            error("Failed to fetch chat admin script: " .. err)
        end
        local func, loadError = loadstring(script)
        if not func then
            error("Failed to compile chat admin script: " .. loadError)
        end
        func()
    end)
    
    if not chatAdminLoaded then
        warn("Failed to load CHAT ADMIN:", chatAdminError)
    end
else
    warn("Failed to load INTERNAL UI:", internalUIError)
end
